
generator client {
    provider      = "prisma-client-js"
    binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  password      String?
  role          String    @default("user")
  firstName     String?
  lastName      String?
  accounts      Account[]
  sessions      Session[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Prospect {
  id                     String                 @id @default(cuid())
  companyName           String
  businessType          String?
  address               String?
  city                  String?
  phone                 String?
  email                 String?
  website               String?
  gbpUrl                String?
  googleRating          Float?
  reviewCount           Int?
  yearsInBusiness       Int?
  employeeCount         Int?
  categories            String?
  facebook              String?
  instagram             String?
  linkedin              String?
  twitter               String?
  recentReviews         String?
  growthSignals         String?
  techStack             String?
  placeId               String?               @unique
  icpScore              Float?
  dateCollected         DateTime?
  qualificationSignals  String?
  dataSource            String?
  searchLocation        String?
  leadScore             Float?
  sentimentScore        Float?
  isHotLead             Boolean               @default(false)
  lastAnalyzed          DateTime?
  aiRecommendations     String?
  anomaliesDetected     String?
  contactedAt           DateTime?
  isConverted           Boolean               @default(false)
  notes                 String?
  tags                  String?
  outreachStrategy      String?
  painPoints            String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  historicalData        ProspectHistorical[]
  reviews               ProspectReview[]
  activities            ProspectActivity[]
}

model ProspectHistorical {
  id            String    @id @default(cuid())
  prospectId    String
  prospect      Prospect  @relation(fields: [prospectId], references: [id], onDelete: Cascade)
  googleRating  Float?
  reviewCount   Int?
  phone         String?
  website       String?
  businessHours String?
  photos        String?
  posts         String?
  recordedAt    DateTime  @default(now())
}

model ProspectReview {
  id            String    @id @default(cuid())
  prospectId    String
  prospect      Prospect  @relation(fields: [prospectId], references: [id], onDelete: Cascade)
  reviewId      String?   @unique
  author        String?
  rating        Int?
  text          String?
  publishedAt   DateTime?
  sentiment     String?
  sentimentScore Float?
  extractedAt   DateTime  @default(now())
}

model MarketTrend {
  id          String    @id @default(cuid())
  category    String
  title       String
  content     String
  source      String?
  trend       String?
  relevance   Float?
  publishedAt DateTime?
  extractedAt DateTime  @default(now())
}

model NewBusiness {
  id               String    @id @default(cuid())
  companyName      String
  businessType     String?
  address          String?
  city             String?
  placeId          String?   @unique
  googleRating     Float?
  reviewCount      Int?
  firstSeenAt      DateTime
  isNewListing     Boolean   @default(true)
  isNewReviews     Boolean   @default(false)
  detectedAt       DateTime  @default(now())
}

model ProspectActivity {
  id          String    @id @default(cuid())
  prospectId  String
  prospect    Prospect  @relation(fields: [prospectId], references: [id], onDelete: Cascade)
  activityType String  // 'note', 'status_change', 'ai_analysis', 'contact_attempt', 'tag_added'
  content     String?
  metadata    String?  // JSON string for additional data
  createdBy   String?
  createdAt   DateTime  @default(now())
}

model SystemJob {
  id          String    @id @default(cuid())
  jobType     String
  status      String    @default("pending")
  payload     String?
  result      String?
  error       String?
  scheduledAt DateTime?
  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
}
